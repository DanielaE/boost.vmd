<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=US-ASCII">
<title>Testing for empty input</title>
<link rel="stylesheet" href="../../../../../doc/src/boostbook.css" type="text/css">
<meta name="generator" content="DocBook XSL Stylesheets V1.78.1">
<link rel="home" href="../index.html" title="Chapter&#160;1.&#160;The Variadic Macro Data Library 1.6">
<link rel="up" href="../index.html" title="Chapter&#160;1.&#160;The Variadic Macro Data Library 1.6">
<link rel="prev" href="vmd_low_level.html" title="Low-level preprocessor functionality">
<link rel="next" href="vmd_test_parens.html" title="Testing and removing parens">
</head>
<body bgcolor="white" text="black" link="#0000FF" vlink="#840084" alink="#0000FF">
<table cellpadding="2" width="100%"><tr>
<td valign="top"><img alt="Boost C++ Libraries" width="277" height="86" src="../../../../../boost.png"></td>
<td align="center"><a href="../../../../../index.html">Home</a></td>
<td align="center"><a href="../../../../../libs/libraries.htm">Libraries</a></td>
<td align="center"><a href="http://www.boost.org/users/people.html">People</a></td>
<td align="center"><a href="http://www.boost.org/users/faq.html">FAQ</a></td>
<td align="center"><a href="../../../../../more/index.htm">More</a></td>
</tr></table>
<hr>
<div class="spirit-nav">
<a accesskey="p" href="vmd_low_level.html"><img src="../../../../../doc/src/images/prev.png" alt="Prev"></a><a accesskey="u" href="../index.html"><img src="../../../../../doc/src/images/up.png" alt="Up"></a><a accesskey="h" href="../index.html"><img src="../../../../../doc/src/images/home.png" alt="Home"></a><a accesskey="n" href="vmd_test_parens.html"><img src="../../../../../doc/src/images/next.png" alt="Next"></a>
</div>
<div class="section">
<div class="titlepage"><div><div><h2 class="title" style="clear: both">
<a name="the_variadic_macro_data_library.vmd_test_empty"></a><a class="link" href="vmd_test_empty.html" title="Testing for empty input">Testing
    for empty input</a>
</h2></div></div></div>
<p>
      Currently Boost PP has an undocumented macro for testing whether a parameter
      is empty of not, written without the use of variadic macros. The macro is called
      BOOST_PP_IS_EMPTY. The macro is by its nature flawed, since there is no generalized
      way of determining whether or not a parameter is empty using the C++ preprocessor.
      But the macro will work given some limited inputs or emptiness. Paul Mensonides,
      the developer of Boost PP and the BOOST_PP_IS_EMPTY macro in that library,
      also wrote a better macro, using variadic macros, for determining whether or
      not a parameter is empty or not. This macro is also not perfect, since there
      is no perfect solution, but will work correctly with almost all input. I have
      adapted his code for the VMD and developed my own slightly different code to
      work with the Visual C++ compiler since Paul's code would not work as is because
      of deficiencies in the Visual C++ preprocessor.
    </p>
<p>
      The macro is called <code class="computeroutput"><a class="link" href="../BOOST_VMD_IS_EMPTY.html" title="Macro BOOST_VMD_IS_EMPTY">BOOST_VMD_IS_EMPTY</a></code>
      and will return 1 if its input is empty or 0 if its input is not empty. The
      macro is a variadic macro which make take any input <a href="#ftn.the_variadic_macro_data_library.vmd_test_empty.f0" class="footnote" name="the_variadic_macro_data_library.vmd_test_empty.f0"><sup class="footnote">[1]</sup></a>.
    </p>
<h4>
<a name="the_variadic_macro_data_library.vmd_test_empty.h0"></a>
      <span class="phrase"><a name="the_variadic_macro_data_library.vmd_test_empty.macro_flaw"></a></span><a class="link" href="vmd_test_empty.html#the_variadic_macro_data_library.vmd_test_empty.macro_flaw">Macro Flaw</a>
    </h4>
<p>
      The one situation where the macro may not work properly is if its input is
      a function-like macro name. The problem that will occur for a standard C++
      conforming preprocessor is that if the function-like macro takes two or more
      parameters, a compiler error will occur. Otherwise the BOOST_VMD_IS_EMPTY macro
      will work properly even if the input is a function-like macro name with 0 or
      1 parameter.
    </p>
<h4>
<a name="the_variadic_macro_data_library.vmd_test_empty.h1"></a>
      <span class="phrase"><a name="the_variadic_macro_data_library.vmd_test_empty.macro_flaw_with_visual_c__"></a></span><a class="link" href="vmd_test_empty.html#the_variadic_macro_data_library.vmd_test_empty.macro_flaw_with_visual_c__">Macro
      Flaw with Visual C++</a>
    </h4>
<p>
      The VC++ preprocessor is not a standard C++ conforming preprocessor in at least
      two situations which cause the BOOST_VMD_IS_EMPTY macro to not work properly
      using VC++ when the input is a function-like macro name.
    </p>
<p>
      The first situation is that if a macro taking 'n' number of parameters is invoked
      with 0 to 'n-1' parameters, the compiler does not give an error, but only a
      warning.
    </p>
<pre class="programlisting"><span class="preprocessor">#define</span> <span class="identifier">FMACRO</span><span class="special">(</span><span class="identifier">x</span><span class="special">,</span><span class="identifier">y</span><span class="special">)</span> <span class="identifier">x</span> <span class="special">+</span> <span class="identifier">y</span>

<span class="identifier">FMACRO</span><span class="special">(</span><span class="number">1</span><span class="special">)</span>
</pre>
<p>
      should give a compiler error but when invoked using VC++ it only gives a warning
      and VC++ continues macro substitution with 'y' as a placemarker preprocessing
      token.
    </p>
<p>
      The second situation is that the expansion of a macro works incorrectly when
      the expanded macro is a function-like macro name followed by a function-like
      macro invocation, in which case the macro re-expansion is erroneously done
      more than once. This latter case can be seen by this exmaple:
    </p>
<pre class="programlisting"><span class="preprocessor">#define</span> <span class="identifier">FMACRO1</span><span class="special">(</span><span class="identifier">parameter</span><span class="special">)</span> <span class="identifier">FMACRO3</span> <span class="identifier">parameter</span><span class="special">()</span>
<span class="preprocessor">#define</span> <span class="identifier">FMACRO2</span><span class="special">()</span> <span class="special">()</span>
<span class="preprocessor">#define</span> <span class="identifier">FMACRO3</span><span class="special">()</span> <span class="number">1</span>

<span class="identifier">FMACRO1</span><span class="special">(</span><span class="identifier">FMACRO2</span><span class="special">)</span>

<span class="identifier">should</span> <span class="identifier">expand</span> <span class="identifier">to</span><span class="special">:</span>

<span class="identifier">FMACRO3</span><span class="special">()</span>

<span class="identifier">but</span> <span class="identifier">in</span> <span class="identifier">VC</span><span class="special">++</span> <span class="identifier">it</span> <span class="identifier">expands</span> <span class="identifier">to</span><span class="special">:</span>

<span class="number">1</span>
</pre>
<p>
      where after initially expanding the macro to:
    </p>
<pre class="programlisting"><span class="identifier">FMACRO3</span> <span class="identifier">FMACRO2</span><span class="special">()</span>
</pre>
<p>
      VC++ erroneously rescans the sequence of tokens more than once rather than
      rescan once for more macro names.
    </p>
<p>
      What these preprocessor flaws in the VC++ compiler mean is that if a function-like
      macro name is passed as input to the macro, and the function-like macro when
      expanded is a set of parentheses '()' with 0 or more tokens inside them, BOOST_VMD_IS_EMPTY
      will erroneously return 1 rather than 0 when using the Visual C++ compiler.
    </p>
<h4>
<a name="the_variadic_macro_data_library.vmd_test_empty.h2"></a>
      <span class="phrase"><a name="the_variadic_macro_data_library.vmd_test_empty.macro_flaw_conclusion"></a></span><a class="link" href="vmd_test_empty.html#the_variadic_macro_data_library.vmd_test_empty.macro_flaw_conclusion">Macro
      Flaw conclusion</a>
    </h4>
<p>
      With all of the above mentioned, the case(s) where BOOST_VMD_IS_EMPTY will
      work incorrectly are very small, even with the erroneous VC++ preprocessor,
      and I considered the macro worthwhile to use with the vast majority of possible
      input. Obviously the macro should be used by the end-user when the possible
      input to it is constrained but it can still serve a purpose in preprocessor
      programming. The macro is used extensively in the assert-like macros explained
      further on in the documentation and macro programmers may find this macro useful
      in their own programming efforts despite the slight flaw in the way that it
      works.
    </p>
<p>
      The end-user of VMD can include the individual header file 'vmd_is_empty.hpp'
      instead of the general header file 'vmd.hpp' for using this macro.
    </p>
<div class="footnotes">
<br><hr style="width:100; text-align:left;margin-left: 0">
<div id="ftn.the_variadic_macro_data_library.vmd_test_empty.f0" class="footnote"><p><a href="#the_variadic_macro_data_library.vmd_test_empty.f0" class="para"><sup class="para">[1] </sup></a>
        For VC++ 8 the input is not variadic data but a single parameter
      </p></div>
</div>
</div>
<table xmlns:rev="http://www.cs.rpi.edu/~gregod/boost/tools/doc/revision" width="100%"><tr>
<td align="left"></td>
<td align="right"><div class="copyright-footer">Copyright &#169; 2010-2013 Tropic
      Software East Inc</div></td>
</tr></table>
<hr>
<div class="spirit-nav">
<a accesskey="p" href="vmd_low_level.html"><img src="../../../../../doc/src/images/prev.png" alt="Prev"></a><a accesskey="u" href="../index.html"><img src="../../../../../doc/src/images/up.png" alt="Up"></a><a accesskey="h" href="../index.html"><img src="../../../../../doc/src/images/home.png" alt="Home"></a><a accesskey="n" href="vmd_test_parens.html"><img src="../../../../../doc/src/images/next.png" alt="Next"></a>
</div>
</body>
</html>
